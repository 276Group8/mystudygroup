
<div class="large-panel panel-default">
  <h1> Study Spots </h1>

  <div class="row">

  <div class="col-2">
    <div class="sidebar" id="sidebar">

    </div>
  </div>

  <div class="col-10">
    <div id="map" style="width:100%; height:400px"></div>
  </div>
</div>
<script>
  var gmarkers = [];
  initMap();

  function initMap() {
    var sfu = {lat: 49.2793539, lng: -122.9159272};
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 17,
      center: sfu
    });

    var infowindow = new google.maps.InfoWindow();


    var assignListener = function(marker, contentString){
                          return function() {
                                 infowindow.setContent(contentString);
                                 infowindow.open(map, marker);
                                  };
                        };

    <% @groups.each do |group| %>
      var marker = new google.maps.Marker({
        map: map,
        position: { lat: <%= group.latitude %>, lng: <%= group.longitude %> },
        title: "<%= group.name %>"
      });

      var contentString = '<div id="content">'+
          '<div id="siteNotice">'+
          '</div>'+
          '<h1 id="firstHeading" class="firstHeading"><%= group.name %></h1>'+
          '<div id="bodyContent">'+
          '<p>Course: <%= group.course.name %> </p>' +
          '<p>Location: <%= group.location_description %> </p>' +
          '<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTYHmw_GH78M_9GALfD0i_fRKLj41i6Nlu8_u1-hx4jCxhHXOfJ" style="width:50px;height:50px;"></img>' +
          '<button class="primary-set">Join group!</button>'+
          '</div>'+
          '</div>';

      marker.addListener('click', assignListener(marker, contentString) );
      gmarkers.push(marker);

      createMarkerButton(marker);
    <% end %>
  }

  function createMarkerButton(marker) {
    //Creates a sidebar button
    var ul = document.getElementById("sidebar");
    var li = document.createElement("li");
    var title = marker.getTitle();
    li.innerHTML = title;
    ul.appendChild(li);

    //Trigger a click event to marker when the button is clicked.
    google.maps.event.addDomListener(li, "click", function(){
      google.maps.event.trigger(marker, "click");
    });
  }
</script>
